<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analyze Widget</title>

    <!-- Include jQuery from CDN -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Include Chart.js from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Include DataTables CSS from CDN -->
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css"
    />
    <!-- Include DataTables JS from CDN -->
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <!-- Include Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Includes Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
      .scrollbar::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      .scrollbar::-webkit-scrollbar-track {
        background: #e5e7eb;
      }

      .scrollbar::-webkit-scrollbar-thumb {
        background: #9ca3af;
        border-radius: 6px;
      }

      .scrollbar::-webkit-scrollbar-thumb:hover {
        background: #6b7280;
      }

      .dataTables_wrapper .dataTables_filter input {
        padding: 0.5rem;
        border: 1px solid #d1d5db; /* Tailwind Gray-300 */
        border-radius: 0.375rem; /* Tailwind rounded-md */
        background-color: white; /* Tailwind Gray-100 */
        margin-left: 0.5rem;
        width: 300px; /* Adjust width if needed */
      }

      .dataTables_wrapper .dataTables_filter label {
        color: #4b5563; /* Tailwind Gray-700 */
        font-size: 0.875rem; /* Tailwind text-sm */
      }

      .dataTables_wrapper .dataTables_paginate .paginate_button {
        padding: 0.25rem 0.75rem;
        margin: 0 0.25rem;
        color: #1f2937; /* Tailwind Gray-800 */
        border: 1px solid #d1d5db; /* Tailwind Gray-300 */
        border-radius: 0.375rem; /* Tailwind rounded-md */
        background-color: #ffffff; /* Tailwind white */
        text-decoration: none;
      }

      .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
        background-color: #e5e7eb; /* Tailwind Gray-200 */
      }

      .dataTables_wrapper .dataTables_paginate .paginate_button.current {
        background-color: #3b82f6; /* Tailwind Blue-500 */
        color: #ffffff; /* White text for active page */
        border-color: #3b82f6;
      }

      .dataTables_wrapper .dataTables_paginate .paginate_button.disabled {
        background-color: #f9fafb; /* Tailwind Gray-100 */
        color: #9ca3af; /* Tailwind Gray-400 */
        cursor: not-allowed;
      }

      .dataTables_wrapper .dataTables_info {
        padding-top: 0.5rem;
        color: #6b7280; /* Tailwind Gray-600 */
        font-size: 0.875rem; /* Tailwind text-sm */
      }

      .dataTables_wrapper .dataTables_length select {
        padding: 0.5rem;
        border: 1px solid #d1d5db; /* Tailwind Gray-300 */
        border-radius: 0.375rem; /* Tailwind rounded-md */
        background-color: #f9fafb; /* Tailwind Gray-100 */
        margin-right: 0.5rem;
      }

      .dataTables_wrapper .dataTables_length label {
        color: #4b5563; /* Tailwind Gray-700 */
        font-size: 0.875rem; /* Tailwind text-sm */
      }

      .dataTables_wrapper th {
        background-color: #f3f4f6; /* Tailwind Gray-50 */
        color: #374151; /* Tailwind Gray-700 */
        font-weight: 600;
        text-align: left;
        padding: 0.75rem;
        border-bottom: 1px solid #d1d5db; /* Tailwind Gray-300 */
      }

      .dataTables_processing {
        padding: 1rem;
        background-color: #f9fafb; /* Tailwind Gray-100 */
        color: #374151; /* Tailwind Gray-700 */
        font-size: 1rem;
        border: 1px solid #d1d5db; /* Tailwind Gray-300 */
        border-radius: 0.375rem; /* Tailwind rounded-md */
      }

      .dataTables_wrapper tbody tr:hover {
        background-color: #f3f4f6; /* Tailwind Gray-50 */
      }

      .dataTables_wrapper tbody td {
        padding: 0.75rem;
        border-bottom: 1px solid #e5e7eb; /* Tailwind Gray-200 */
        color: #4b5563; /* Tailwind Gray-700 */
      }

      .dataTables_wrapper thead th {
        padding: 0.75rem;
        border-bottom: 2px solid #d1d5db; /* Tailwind Gray-300 */
        font-weight: 600;
        text-align: left;
        color: #374151; /* Tailwind Gray-700 */
      }
    </style>
  </head>
  <body class="scrollbar">
    <!-- Header -->
    <div class="border-b border-gray-200 px-3 h-[60px] flex items-center">
      <!-- Tabs -->
      <div
        class="flex flex-wrap -mb-px text-sm font-medium text-center text-gray-500 p-1 w-fit rounded-xl bg-gray-100"
        id="tabs"
      >
        <button
          class="main-tab-button inline-flex gap-1 items-center justify-center px-4 py-2.5 group w-[160px]"
          id="analyze-tab"
        >
          <i data-lucide="chart-spline" class="w-4 h-4"></i>
          Analyze
        </button>

        <button
          class="main-tab-button inline-flex gap-1 items-center justify-center px-4 py-2.5 group w-[160px]"
          id="history-tab"
        >
          <i data-lucide="history" class="w-4 h-4"></i>
          History Positions
        </button>
      </div>
      <!-- End Tabs -->
    </div>
    <!-- End Header -->

    <!-- Analyze Tab Content -->
    <div
      id="analyze-loading"
      class="px-3 flex items-center justify-center gap-2 text-lg text-blue-600 h-[calc(100vh-60px)]"
    >
      <div
        role="status"
        class="flex flex-col justify-center items-center gap-2"
      >
        <svg
          aria-hidden="true"
          class="w-10 h-10 text-gray-200 animate-spin fill-blue-600"
          viewBox="0 0 100 101"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z"
            fill="currentColor"
          />
          <path
            d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z"
            fill="currentFill"
          />
        </svg>
        <span>Loading...</span>
      </div>
    </div>
    <div
      id="analyze-error"
      class="h-[calc(100vh-60px)] flex justify-center items-center"
    >
      <div
        class="flex items-center gap-2 p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-50 w-full max-w-xs"
        role="alert"
      >
        <i data-lucide="circle-alert" class="w-4 h-4"></i>
        <div id="analyze-error-message">
          <!-- Analyze Error -->
        </div>
      </div>
    </div>
    <div
      id="analyze"
      class="tab-content p-3 grid grid-cols-4 gap-x-3 gap-y-3 bg-gray-100"
    >
      <!-- Summary Stats -->
      <div class="summary-card rounded-xl col-span-4">
        <div
          class="summary-card-content grid grid-cols-2 lg:grid-cols-4 xl:grid-cols-8 gap-x-3 gap-y-10 col-span-4"
        >
          <!-- Stat cards will be appended here -->
        </div>
      </div>
      <!-- End Summary Stats -->

      <!-- Summary Chart -->
      <div class="rounded-2xl shadow bg-white p-6 col-span-4 lg:col-span-2">
        <div class="text-lg font-semibold mb-4">Financial Overview</div>
        <div class="w-full h-[260px]">
          <canvas id="summaryChart"></canvas>
        </div>
      </div>
      <!-- End Summary Chart -->

      <!-- Prop Analyze -->
      <div
        id="prop-analyze-content"
        class="rounded-2xl col-span-4 lg:col-span-2 grid md:grid-cols-2 gap-3"
      >
        <!-- Render Prop Analyze Items -->
      </div>
      <!-- End Prop Analyze -->

      <!-- Max Drawdown Items -->
      <div
        id="max-drawdown-loading"
        class="w-full h-[200px] grid lg:grid-cols-2 gap-3 2xl:grid-cols-4 col-span-4"
      >
        <div
          class="rounded-2xl bg-white shadow flex justify-center items-center"
        >
          <svg
            aria-hidden="true"
            class="w-10 h-10 text-gray-200 animate-spin fill-blue-600"
            viewBox="0 0 100 101"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z"
              fill="currentColor"
            />
            <path
              d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z"
              fill="currentFill"
            />
          </svg>
        </div>
        <div
          class="rounded-2xl bg-white shadow flex justify-center items-center"
        >
          <svg
            aria-hidden="true"
            class="w-10 h-10 text-gray-200 animate-spin fill-blue-600"
            viewBox="0 0 100 101"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z"
              fill="currentColor"
            />
            <path
              d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z"
              fill="currentFill"
            />
          </svg>
        </div>
        <div
          class="rounded-2xl bg-white shadow flex justify-center items-center"
        >
          <svg
            aria-hidden="true"
            class="w-10 h-10 text-gray-200 animate-spin fill-blue-600"
            viewBox="0 0 100 101"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z"
              fill="currentColor"
            />
            <path
              d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z"
              fill="currentFill"
            />
          </svg>
        </div>
        <div
          class="rounded-2xl bg-white shadow flex justify-center items-center"
        >
          <svg
            aria-hidden="true"
            class="w-10 h-10 text-gray-200 animate-spin fill-blue-600"
            viewBox="0 0 100 101"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z"
              fill="currentColor"
            />
            <path
              d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z"
              fill="currentFill"
            />
          </svg>
        </div>
      </div>
      <div
        id="max-drawdown-content"
        class="w-full grid md:grid-cols-2 gap-3 2xl:grid-cols-4 col-span-4"
      >
        <!-- Render Max Drawdown -->
      </div>
      <!-- End Max Drawdown Items -->

      <!-- History Charts -->
      <div class="card col-span-4 p-5 rounded-2xl bg-white shadow">
        <div class="card-header flex md:flex-row justify-between gap-y-5">
          <div class="text-lg font-medium flex items-center gap-2">
            Balance & Growth
          </div>
          <div class="tabs-list w-fit p-1 rounded-xl bg-gray-100">
            <button
              class="history-tabs-button px-3 py-1.5 text-gray-500 text-sm font-medium"
              id="balance-tab"
            >
              Balance
            </button>
            <button
              class="history-tabs-button px-3 py-1.5 text-gray-500 text-sm font-medium"
              id="growth-tab"
            >
              Growth
            </button>
          </div>
        </div>
        <div id="history-charts-content">
          <div id="balance">
            <canvas
              id="balanceChart"
              class="h-[350px] h-[450px] max-h-[550px]"
            ></canvas>
          </div>
          <div id="growth">
            <canvas
              id="growthChart"
              class="h-[350px] h-[450px] max-h-[550px]"
            ></canvas>
          </div>
        </div>
      </div>
      <!-- End History Charts -->

      <!-- Tradeing Methods -->
      <div
        class="col-span-4 md:col-span-2 2xl:col-span-1 bg-white rounded-2xl shadow p-6"
      >
        <div class="text-lg font-semibold mb-4">Trading Methods</div>
        <div class="flex flex-col items-center">
          <canvas
            id="tradingMethodsChart"
            class="aspect-square min-w-[100px] max-h-[300px] max-w-[300px] -mt-3"
          ></canvas>
          <div
            class="grid grid-cols-2 w-full gap-x-0 gap-y-10 mt-3 flex-1"
            id="tradingMethodsInfoCards"
          >
            <!-- Info cards will be dynamically generated here -->
          </div>
        </div>
      </div>
      <!-- End Tradeing Methods -->

      <!-- Profit vs Loss -->
      <div
        class="col-span-4 md:col-span-2 2xl:col-span-1 bg-white rounded-2xl shadow p-6"
      >
        <div class="text-lg font-semibold mb-4">Profit vs Loss</div>
        <canvas
          id="countTradeRadialChart"
          class="aspect-square min-w-[100px] max-w-[200px] max-h-[200px] mx-auto mb-12"
        ></canvas>
        <div class="flex justify-center items-center w-full gap-7">
          <div class="flex flex-col items-center">
            <i data-lucide="trending-up" class="w-5 h-5 text-blue-500"></i>
            <div class="text-2xl font-semibold" id="profitPercentage">
              <!-- Profit Percent -->
            </div>
            <div class="text-sm text-muted-foreground" id="profitCount">
              <!-- Profit -->
            </div>
          </div>
          <div class="text-base font-semibold">vs</div>
          <div class="flex flex-col items-center">
            <i data-lucide="trending-down" class="w-5 h-5 text-red-500"></i>
            <div class="text-2xl font-semibold" id="lossPercentage">
              <!-- Loss Percent -->
            </div>
            <div class="text-sm text-muted-foreground" id="lossCount">
              <!-- Loss -->
            </div>
          </div>
        </div>
        <hr class="mt-10 mb-5 border-gray-200" />
        <div class="w-full flex flex-col gap-4">
          <div>
            <div class="flex justify-between items-center">
              <div class="flex items-center gap-2 w-full">
                <i data-lucide="bar-chart"></i>
                <div class="text-sm font-medium">Total Trades</div>
              </div>
              <div id="totalTrades" class="text-xl font-semibold"></div>
            </div>
            <p class="text-[13px] text-gray-500">Total trades analyzed</p>
          </div>
          <div>
            <div class="flex justify-between items-center mt-4">
              <div class="flex items-center gap-2 w-full">
                <i data-lucide="pie-chart"></i>
                <div class="text-sm font-medium">Profit Factor</div>
              </div>
              <div id="profitFactor" class="text-xl font-semibold"></div>
            </div>
            <p class="text-[13px] text-gray-500" id="dayTradeAverage"></p>
          </div>
        </div>
      </div>
      <!-- End Profit vs Loss -->

      <!-- Now Status -->
      <div class="col-span-4 2xl:col-span-2 bg-white rounded-2xl shadow p-6">
        <div class="card-header">
          <h2 class="text-xl font-semibold">Now Status</h2>
        </div>
        <div class="mt-5">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-10 mb-20">
            <div class="h-64">
              <h3 class="text-base font-semibold mb-2">Balance Range</h3>
              <canvas
                id="balanceRangeChart"
                height="250"
                class="w-full h-full"
              ></canvas>
            </div>
            <div class="h-64">
              <h3 class="text-base font-semibold mb-2">Account Overview</h3>
              <canvas
                id="accountOverviewChart"
                height="250"
                class="w-full h-full"
              ></canvas>
            </div>
          </div>
          <div
            id="statsContainer"
            class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-x-4 gap-y-10"
          ></div>
        </div>
      </div>
      <!-- End Now Status -->

      <!-- Positions & Orders -->
      <div class="rounded-2xl shadow p-6 bg-white col-span-4">
        <div class="card-header">
          <h2 class="text-lg font-semibold">Positions & Orders</h2>
        </div>
        <div class="relative overflow-auto mt-5 scrollbar max-h-[466.6px]">
          <table class="w-full text-xs text-left text-black">
            <thead class="text-[13px] text-black uppercase bg-gray-50">
              <tr>
                <th scope="col" class="px-6 py-4 rounded-s-lg">Ticket</th>
                <th scope="col" class="px-6 py-4">Symbol</th>
                <th scope="col" class="px-6 py-4">Time</th>
                <th scope="col" class="px-6 py-4">Type</th>
                <th scope="col" class="px-6 py-4">Volume</th>
                <th scope="col" class="px-6 py-4">Open Price</th>
                <th scope="col" class="px-6 py-4">S / L</th>
                <th scope="col" class="px-6 py-4">T / P</th>
                <th scope="col" class="px-6 py-4">Price</th>
                <th scope="col" class="px-6 py-4">Swap</th>
                <th scope="col" class="px-6 py-4">Profit</th>
                <th scope="col" class="px-6 py-4 rounded-e-lg">Reason</th>
              </tr>
            </thead>
            <tbody id="positions-orders-table-body"></tbody>
          </table>
        </div>
      </div>
      <!-- End Positions & Orders -->

      <!-- Chart Drawdown -->
      <div
        id="chart-container"
        class="col-span-4 rounded-2xl shadow bg-white p-6"
      >
        <h2 class="text-lg font-semibold mb-4">Chart Drawdown</h2>
        <div
          id="chart-drawdown-loading"
          class="flex items-center justify-center w-full h-[300px] lg:h-[300px] xl:h-[450px] w-full hidden"
        >
          <svg
            aria-hidden="true"
            class="w-10 h-10 text-gray-200 animate-spin fill-blue-600"
            viewBox="0 0 100 101"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z"
              fill="currentColor"
            />
            <path
              d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z"
              fill="currentFill"
            />
          </svg>
        </div>

        <canvas
          id="chart-drawdown"
          class="h-[450px] w-full max-h-[500px]"
        ></canvas>
      </div>
      <!-- End Chart Drawdown -->
    </div>
    <!-- End Analyze Tab Content -->

    <!-- History Tabs Content -->
    <div id="history" class="tab-content hidden">
      <div
        id="history-positions-loading"
        class="px-3 flex items-center justify-center gap-2 text-lg text-blue-600 h-[calc(100vh-60px)]"
      >
        <div
          role="status"
          class="flex flex-col justify-center items-center gap-2"
        >
          <svg
            aria-hidden="true"
            class="w-10 h-10 text-gray-200 animate-spin fill-blue-600"
            viewBox="0 0 100 101"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z"
              fill="currentColor"
            />
            <path
              d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z"
              fill="currentFill"
            />
          </svg>
          <span>Loading...</span>
        </div>
      </div>
      <div id="history-positions-content">
        <h2 class="mt-8 text-xl">History Positions</h2>
        <div class="p-3">
          <table id="history-positions-table" class="!mx-0 !w-full">
            <thead class="text-xs text-gray-700 bg-gray-100">
              <tr>
                <th scope="col" class="px-6 !py-4 !border-none rounded-s-lg">
                  Ticket
                </th>
                <th scope="col" class="px-6 !py-4 !border-none">Symbol</th>
                <th scope="col" class="px-6 !py-4 !border-none">Time</th>
                <th scope="col" class="px-6 !py-4 !border-none">Type</th>
                <th scope="col" class="px-6 !py-4 !border-none">Volume</th>
                <th scope="col" class="px-6 !py-4 !border-none">OpenPrice</th>
                <th scope="col" class="px-6 !py-4 !border-none">ClosePrice</th>
                <th scope="col" class="px-6 !py-4 !border-none">TimeClose</th>
                <th scope="col" class="px-6 !py-4 !border-none">Duration</th>
                <th scope="col" class="px-6 !py-4 !border-none">Commission</th>
                <th scope="col" class="px-6 !py-4 !border-none">Swap</th>
                <th scope="col" class="px-6 !py-4 !border-none">Profit</th>
                <th scope="col" class="px-6 !py-4 !border-none rounded-e-lg">
                  Reason
                </th>
              </tr>
            </thead>
            <tbody class="text-sm">
              <!-- <tr>
                <td>January</td>
                <td>120</td>
              </tr>
              <tr>
                <td>February</td>
                <td>150</td>
              </tr>
              <tr>
                <td>March</td>
                <td>180</td>
              </tr>
              <tr>
                <td>April</td>
                <td>220</td>
              </tr>
              <tr>
                <td>May</td>
                <td>260</td>
              </tr>
              <tr>
                <td>June</td>
                <td>300</td>
              </tr> -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <!-- End History Tabs Content -->

    <script>
      lucide.createIcons();

      // Fetching Analyze Data
      function fetchAnalyzeData(login) {
        const url = `https://socket.unfxco.com/mt5/api/analyze/basic?login=${login}`;
        const APIKey =
          "6a4ce048dffdc0637965e1128a551b54983aa6e61cb28ec9df692c3184683d20";

        return fetch(url, { headers: { APIKey } });
      }
      // End Fetching Analyze Data

      // Fetching Drawdown Data
      function fetchDrawdownData(login) {
        const url = `https://socket.unfxco.com/mt5/api/analyze/drawdown/chart?login=${login}`;
        const APIKey =
          "6a4ce048dffdc0637965e1128a551b54983aa6e61cb28ec9df692c3184683d20";

        return fetch(url, { headers: { APIKey } });
      }
      // End Fetching Drawdown Data

      function fetchHistoryPositionsData(login) {
        const url = `https://socket.unfxco.com/mt5/api/position/public/history?login=${login}`;
        const APIKey =
          "6a4ce048dffdc0637965e1128a551b54983aa6e61cb28ec9df692c3184683d20";

        return fetch(url, { headers: { APIKey } });
      }
      // End Fetching Drawdown Data

      // Summary Stats Functionality
      function formatValue(value) {
        return new Intl.NumberFormat("en-US", {
          style: "currency",
          currency: "USD",
          minimumFractionDigits: 2,
          maximumFractionDigits: 2,
        }).format(value);
      }

      function createSumStatCard(title, value, iconName) {
        var trendIcon =
          value >= 0
            ? '<i data-lucide="trending-up" class="text-green-500 w-4 h-4"></i>'
            : '<i data-lucide="trending-down" class="text-red-500 w-4 h-4"></i>';

        return `
                    <div class="border shadow-sm bg-white rounded-lg px-3 py-4">
                      <div class="flex gap-1 flex-row items-center space-y-0 pb-2">
                        <i data-lucide="${iconName}" class="w-4 h-4 text-gray-500"></i>
                        <div class="text-sm font-medium">${title}</div>
                      </div>
                      <div>
                        <div class="text-xl font-semibold">${formatValue(
                          value
                        )}</div>
                        <p class="text-xs text-muted-foreground flex gap-1">
                          ${trendIcon} ${Math.abs(value).toFixed(2)}
                        </p>
                      </div>
                    </div>
                  `;
      }

      function renderSumStats(data) {
        var statsContainer = $(".summary-card-content");
        statsContainer.empty();

        statsContainer.append(
          createSumStatCard("Profit", data.SumProfit, "dollar-sign")
        );
        statsContainer.append(
          createSumStatCard("Commission", data.SumCommission, "scale")
        );
        statsContainer.append(
          createSumStatCard("Net Profit", data.SumNetProfit, "dollar-sign")
        );
        statsContainer.append(
          createSumStatCard("Swap", data.SumSwap, "arrow-left-right")
        );
        statsContainer.append(
          createSumStatCard("Withdrawals", data.SumWithdrawals, "arrow-up")
        );
        statsContainer.append(
          createSumStatCard("Deposits", data.SumDeposits, "arrow-down")
        );
        statsContainer.append(
          createSumStatCard("Start Balance", data.StartBalance, "wallet")
        );
        statsContainer.append(
          createSumStatCard(
            "Balance Drawdown",
            data.BalanceDrawdown,
            "arrow-down"
          )
        );

        lucide.createIcons();
      }
      // End Summary Stats Functionality

      // Summary Charts Functionality
      const renderSumChart = (data) => {
        const formatChart = (name, value) => {
          return {
            name: name,
            originalValue: value,
            value: Math.abs(value).toFixed(2),
            backgroundColor: value < 0 ? "#f43f5e" : "#3b82f6",
          };
        };

        const dataChart = [
          formatChart("Sum Profit", data.SumProfit),
          formatChart("Sum Commission", data.SumCommission),
          formatChart("Sum Deposits", data.SumDeposits),
          formatChart("Sum Net Profit", data.SumNetProfit),
          formatChart("Sum Swap", data.SumSwap),
          formatChart("Sum Withdrawals", data.SumWithdrawals),
        ];

        const labels = dataChart.map((item) => item.name);
        const chartData = dataChart.map((item) => parseFloat(item.value));
        const backgroundColors = dataChart.map((item) => item.backgroundColor);

        const ctx = $("#summaryChart");
        const myChart = new Chart(ctx, {
          type: "bar",
          data: {
            labels: labels,
            datasets: [
              {
                label: "Financial Overview",
                data: chartData,
                backgroundColor: backgroundColors,
                borderColor: backgroundColors,
                borderRadius: 8,
                // barThickness: 30,
              },
            ],
          },
          options: {
            indexAxis: "y", // Set this for horizontal bars
            scales: {
              x: {
                beginAtZero: true,
                grid: {
                  display: true,
                  drawBorder: false,
                  // color: (context) => {},
                  borderDash: [3, 5],
                },
                ticks: {
                  padding: 10,
                  display: true,
                },
              },
              y: {
                grid: {
                  display: false,
                },
                ticks: {
                  padding: 15,
                  display: true,
                },
              },
            },
            plugins: {
              legend: { display: false },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    return `Value: ${context.raw}`;
                  },
                },
              },
            },
            maintainAspectRatio: false,
            responsive: true,
          },
        });
      };
      // End Summary Charts Functionality

      // Prop Analyze Functionality
      const renderPropAnalyze = (data) => {
        const propData = [
          {
            label: "6 Day Trade",
            value: data.DayTrade,
            max: 6,
            icon: "clock",
            iconColor: "text-blue-400",
            status: data.DayTrade >= 6 ? "passed" : "stable",
            unit: "Day",
          },
          {
            label: "6 Day Complete Lot",
            value: data.DayTradeCompleteVolume,
            max: 6,
            icon: "trending-up",
            iconColor: "text-purple-400",
            status: data.DayTradeCompleteVolume >= 6 ? "passed" : "stable",
            unit: "Day",
          },
          {
            label: "3 Min Trade",
            value: data.TradeLimitTime,
            max: 3,
            icon: "activity",
            iconColor: "text-rose-400",
            status: data.TradeLimitTime >= 3 ? "rejected" : "passed",
            unit: "Trade",
          },
          {
            label: "Relative Drawdown",
            value: data.RelativeDrawdown,
            max: 3,
            icon: "percent",
            iconColor: "text-yellow-400",
            status: "none",
            unit: "%",
          },
        ];

        propData.forEach((item) => {
          const statusBadge = getStatusBadge(item.status);
          const fillColor = getFillColor(item.status);
          const chartId = `chart-${item.label
            .replace(/\s+/g, "-")
            .toLowerCase()}`;

          const html = `
                      <div class="space-y-4 shadow bg-white rounded-2xl p-6">
                        <div class="flex items-center justify-between">
                          <div class="flex items-center space-x-2">
                            <i data-lucide="${item.icon}" class="w-5 h-5 ${item.iconColor}"></i>
                            <span class="text-base font-semibold">${item.label}</span>
                          </div>
                          ${statusBadge}
                        </div>
                        <div class="flex items-center space-x-4">
                          <div><canvas id="${chartId}" width="80" height="80"></canvas></div>
                          <div>
                            <p class="text-xl font-semibold">${item.value} ${item.unit}</p>
                            <p class="text-sm text-gray-400">Progress</p>
                          </div>
                        </div>
                      </div>
                    `;

          $("#prop-analyze-content").append(html);

          lucide.createIcons();

          renderChart(chartId, item.value, item.max, fillColor);
        });

        function getStatusBadge(status) {
          switch (status) {
            case "passed":
              return '<span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded">Passed</span>';
            case "stable":
              return '<span class="bg-blue-100 text-blue-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded">Stable</span>';
            case "rejected":
              return '<span class="bg-red-100 text-red-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded">Rejected</span>';
            default:
              return '<span class="bg-gray-100 text-gray-800 text-xs font-medium me-2 px-2.5 py-0.5 rounded">None</span>';
          }
        }

        function getFillColor(status) {
          switch (status) {
            case "passed":
              return "#22c55e";
            case "stable":
              return "#3b82f6";
            case "rejected":
              return "#f43f5e";
            default:
              return "#a855f7";
          }
        }

        function renderChart(chartId, value, max, fillColor) {
          const ctx = document.getElementById(chartId).getContext("2d");
          const step = 100 / max;
          new Chart(ctx, {
            type: "doughnut",
            data: {
              datasets: [
                {
                  data:
                    value <= max ? [value * step, 100 - value * step] : [value],
                  backgroundColor: [fillColor, "#e5e7eb"],
                  borderWidth: 0,
                },
              ],
            },
            options: {
              // circumference: Math.PI,
              // rotation: -Math.PI,
              cutout: "70%",
              responsive: true,
              maintainAspectRatio: false,
              animation: {
                animateRotate: true,
                animateScale: true,
              },
              plugins: {
                tooltip: { enabled: false },
              },
            },
          });
        }
      };
      // End Prop Analyze Functionality

      // Max Drawdowm Functionality
      const renderMaxDrawdown = (data) => {
        const maxDrawDownData = [
          {
            title: "Start",
            value: data.MaxStartBalanceDrawdown * 100,
            time: data.MaxStartBalanceDrawdownTime,
            max: data.PerStartRole,
          },
          {
            title: "EOD",
            value: data.MaxEODBalanceDrawdown * 100,
            time: data.MaxEODBalanceDrawdownTime,
            max: data.PerEODRole,
          },
          {
            title: "MAT",
            value: data.MaxAllTimeBalanceDrawdown * 100,
            time: data.MaxAllTimeBalanceDrawdownTime,
            max: data.PerStartRole,
          },
          {
            title: "MD",
            value: data.MaxDayBalanceDrawdown * 100,
            time: data.MaxDayBalanceDrawdownTime,
            max: data.PerMDRole,
          },
        ];

        maxDrawDownData.forEach(({ value, max, time, title }) => {
          const status = value < max ? "stable" : "rejected";

          const badge = getBadge(status);
          const progress = getProgress(value, max);

          const date = new Date(time);

          const html = `
                                <div class="overflow-hidden rounded-2xl shadow bg-white p-4">
                                  <div class="flex flex-row justify-between items-center pb-4">
                                    <h2 class="text-base font-medium">${title} balance max drawdown</h2>
                                  </div>
                                  <div class="">
                                    <div class="flex items-center justify-between mb-2">
                                      <span class="text-2xl font-semibold drawdown-value">
                                        ${value.toFixed(2)}%
                                      </span>
                                      ${badge}
                                    </div>
                                    ${progress}
                                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                                      <span>${0}%</span>
                                      <span>${max}%</span>
                                    </div>
                                    <div
                                      class="flex items-center justify-between mt-2 text-xs text-gray-500"
                                    >
                                      <span>${value.toFixed(2)}% drawdown</span>
                                      <span>${date.toLocaleString()}</span>
                                    </div>
                                    <div class="flex items-center justify-center mt-2">
                                      ${
                                        value < max
                                          ? "<i data-lucide='check-circle-2' class='text-blue-500'></i>"
                                          : "<i data-lucide='alert-circle' class='text-rose-500'></i>"
                                      }
                                    </div>
                                  </div>
                                </div>
                              `;

          $("#max-drawdown-content").append(html);

          lucide.createIcons();
        });

        function getBadge(status) {
          switch (status) {
            case "passed":
              return '<span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded">Passed</span>';
            case "stable":
              return '<span class="bg-blue-100 text-blue-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded">Stable</span>';
            case "rejected":
              return '<span class="bg-red-100 text-red-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded">Rejected</span>';
            default:
              return '<span class="bg-gray-100 text-gray-800 text-xs font-medium me-2 px-2.5 py-0.5 rounded">None</span>';
          }
        }

        function getProgress(value, max) {
          const transform = `-${100 - value * (100 / max)}%`;

          return `
                                  <div class="relative h-3 w-full overflow-hidden rounded-full bg-gray-100">
                                    <div
                                      class="h-full flex-1 transition-all transform ${
                                        value < max
                                          ? "bg-blue-500"
                                          : "bg-rose-500"
                                      }"
                                      style="transform: translateX(${transform})"
                                    >
                                    </div>
                                  </div>
                                `;
        }
      };

      // End Max Drawdowm Functionality

      // History Charts
      const renderHistoryCharts = (balances, growthes) => {
        const $content = $("#history-charts-content");
        const $tabs = $(".history-tabs-button");
        const defaultTab = "balance";

        function switchTab(tabName) {
          $tabs.removeClass("text-black bg-white rounded-lg shadow");
          $(`#${tabName}-tab`).addClass(
            "text-black bg-white rounded-lg shadow"
          );

          if (tabName === "balance") {
            $("#balance").removeClass("hidden");
            $("#growth").addClass("hidden");
          }
          if (tabName === "growth") {
            $("#growth").removeClass("hidden");
            $("#balance").addClass("hidden");
          }
        }

        switchTab(defaultTab);

        $tabs.on("click", function () {
          const tabName = $(this).attr("id").replace("-tab", "");
          switchTab(tabName);
        });

        const balanceData = balances?.map((item) => ({
          x: new Date(item.Time).toLocaleDateString("en-US", {
            month: "short",
            day: "numeric",
          }),
          y: item.Balance.toFixed(2),
        }));

        const growthData = growthes?.map((item) => ({
          x: new Date(item.Time).toLocaleDateString("en-US", {
            month: "short",
            day: "numeric",
          }),
          y: item.Balance.toFixed(2),
        }));

        const balanceChartCtx = $("#balanceChart")[0].getContext("2d");
        const growthChartCtx = $("#growthChart")[0].getContext("2d");

        const balanceGradient = balanceChartCtx.createLinearGradient(
          0,
          0,
          0,
          450
        );
        balanceGradient.addColorStop(0, "rgba(59, 130, 246, 1)");
        balanceGradient.addColorStop(0.6, "rgba(59, 130, 246, 0.5)");
        balanceGradient.addColorStop(1, "rgba(59, 130, 246, 0.1)");

        const growthGradient = growthChartCtx.createLinearGradient(
          0,
          0,
          0,
          450
        );
        growthGradient.addColorStop(0, "rgba(153, 102, 255, 1)");
        growthGradient.addColorStop(0.5, "rgba(153, 102, 255, 0.8)");
        growthGradient.addColorStop(1, "rgba(153, 102, 255, 0.1)");

        const balanceChart = new Chart(balanceChartCtx, {
          type: "line",
          data: {
            datasets: [
              {
                label: "Balance",
                data: balanceData,
                borderColor: "#3b82f6",
                backgroundColor: balanceGradient,
                borderWidth: 1,
                pointStyle: "circle",
                pointRadius: 0,
                pointHoverRadius: 10,
                fill: true,
                tension: 0.1,
              },
            ],
          },
          options: {
            scales: {
              x: {
                type: "category",
                grid: {
                  display: false,
                },
                ticks: {
                  maxTicksLimit: 20,
                  callback: function (value) {
                    return new Date(
                      this.getLabelForValue(value)
                    ).toLocaleDateString("en-US", {
                      month: "short",
                      day: "numeric",
                    });
                  },
                },
              },
              y: {
                beginAtZero: false,
                grid: {
                  color: "#e5e5e5",
                  drawBorder: false,
                },
                ticks: {
                  count: 10,
                  callback: function (value) {
                    return `$${value.toFixed(2)}`;
                  },
                },
              },
            },
            plugins: {
              legend: { display: false },
              tooltip: {
                callbacks: {
                  title: function (context) {
                    return new Date(context[0].label).toLocaleDateString(
                      "en-US",
                      {
                        month: "short",
                        day: "numeric",
                        year: "numeric",
                      }
                    );
                  },
                  label: function (context) {
                    return `Balance: ${new Intl.NumberFormat("en-US", {
                      style: "currency",
                      currency: "USD",
                    }).format(context.raw.y)}`;
                  },
                },
              },
            },
          },
        });

        // Initialize Growth Chart
        const growthChart = new Chart(growthChartCtx, {
          type: "line",
          data: {
            datasets: [
              {
                label: "Growth",
                data: growthData,
                borderColor: "#a855f7",
                backgroundColor: growthGradient,
                borderWidth: 1,
                pointStyle: "circle",
                pointRadius: 0,
                pointHoverRadius: 10,
                fill: true,
                tension: 0.1,
              },
            ],
          },
          options: {
            scales: {
              x: {
                type: "category",
                grid: {
                  display: false,
                },
                ticks: {
                  maxTicksLimit: 20,
                  callback: function (value) {
                    return new Date(
                      this.getLabelForValue(value)
                    ).toLocaleDateString("en-US", {
                      month: "short",
                      day: "numeric",
                    });
                  },
                },
              },
              y: {
                beginAtZero: false,
                grid: {
                  color: "#e5e5e5",
                  drawBorder: false,
                },
                ticks: {
                  count: 10,
                  callback: function (value) {
                    return `${value.toFixed(2)}`;
                  },
                },
              },
            },
            plugins: {
              legend: { display: false },
              tooltip: {
                callbacks: {
                  title: function (context) {
                    return new Date(context[0].label).toLocaleDateString(
                      "en-US",
                      {
                        month: "short",
                        day: "numeric",
                        year: "numeric",
                      }
                    );
                  },
                  label: function (context) {
                    return `Growth: ${new Intl.NumberFormat("en-US", {
                      style: "currency",
                      currency: "USD",
                    }).format(context.raw.y)}`;
                  },
                },
              },
            },
          },
        });
      };
      // End History Charts

      // Trading Methods
      const renderTradimgMethodsChart = (data) => {
        const chartData = {
          labels: ["Mobile", "Client", "Web", "Algo"],
          datasets: [
            {
              label: "Percent",
              data: [
                data.CountMobileTradingPercentage,
                data.CountClientTradingPercentage,
                data.CountWebTradingPercentage,
                data.CountAlgoTradingPercentage,
              ],
              backgroundColor: "rgba(236, 72, 153, 0.6)",
              borderColor: "rgba(236, 72, 153, 1)",
              borderWidth: 1,
              pointBackgroundColor: "rgba(236, 72, 153, 1)",
            },
          ],
        };

        const tradingMethodsChart = new Chart(
          document.getElementById("tradingMethodsChart"),
          {
            type: "radar",
            data: chartData,
            options: {
              scales: {
                r: {
                  grid: {
                    circular: true, // This makes the grid circular
                  },
                  // angleLines: { display: false },
                  suggestedMin: 0,
                  suggestedMax: 100,
                  ticks: {
                    callback: (value) => `${value}%`,
                  },
                },
              },
              plugins: {
                legend: { display: false },
                tooltip: {
                  callbacks: {
                    label: function (context) {
                      return `${context.raw}%`;
                    },
                  },
                },
              },
            },
          }
        );
      };

      const renderTradingMethods = (data) => {
        const platformData = [
          {
            label: "Mobile Trading",
            value: data.CountMobileTrading,
            percent: data.CountMobileTradingPercentage,
            icon: "smartphone",
            iconColor: "text-blue-500",
          },
          {
            label: "Client Trading",
            value: data.CountClientTrading,
            percent: data.CountClientTradingPercentage,
            icon: "briefcase",
            iconColor: "text-green-500",
          },
          {
            label: "Web Trading",
            value: data.CountWebTrading,
            percent: data.CountWebTradingPercentage,
            icon: "laptop-minimal",
            iconColor: "text-yellow-500",
          },
          {
            label: "Algo Trading",
            value: data.CountAlgoTrading,
            percent: data.CountAlgoTradingPercentage,
            icon: "cpu",
            iconColor: "text-purple-500",
          },
        ];

        const $tradingMethodsInfoCards = $("#tradingMethodsInfoCards");

        platformData.forEach((item) => {
          const cardHtml = `
                      <div class="rounded-lg flex flex-col items-center">
                        <div class="flex items-center gap-1.5">
                          <i data-lucide="${item.icon}" class="h-4 w-4 ${item.iconColor}"></i>
                          <span class="font-medium">${item.label}</span>
                        </div>
                        <div class="mt-1 flex flex-col items-center">
                          <p class="text-2xl font-semibold">${item.value}</p>
                          <p class="text-xs text-gray-500">
                            ${item.percent}
                            <i data-lucide="percent" class="h-3 w-3 inline-block"></i> of total
                          </p>
                        </div>
                      </div>
                    `;
          $tradingMethodsInfoCards.append(cardHtml);

          lucide.createIcons();
        });
      };
      // End Trading Methods

      // Profit vs Loss
      const renderProfitVsLoss = (data) => {
        $("#profitPercentage").text(`${data.CountProfitTradesPercentage}%`);
        $("#profitCount").text(`${data.CountProfitTrades} Profit`);
        $("#lossPercentage").text(`${data.CountLossTradesPercentage}%`);
        $("#lossCount").text(`${data.CountLossTrades} Loss`);
        $("#totalTrades").text(data.CountTrades);
        $("#profitFactor").text(data.ProfitFactor);
        $("#dayTradeAverage").text(`${data.CountDayTrade} Day Trade average`);
      };

      const renderProfitVsLossChart = (data) => {
        const ctx = document
          .getElementById("countTradeRadialChart")
          .getContext("2d");
        const countTradeRadialChart = new Chart(ctx, {
          type: "doughnut",
          data: {
            labels: ["Profit", "Loss"],
            datasets: [
              {
                data: [data.CountProfitTrades, data.CountLossTrades],
                backgroundColor: ["#3b82f6", "#f43f5e"],
                hoverBackgroundColor: ["#60a5fa", "#fb7185"],
                borderWidth: 5,
                cutout: "70%",
                rotation: 270, // start angle at the top
              },
            ],
          },
          options: {
            plugins: {
              legend: { display: false },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    const label = context.label || "";
                    return label + ": " + context.raw + " Trades";
                  },
                },
              },
            },
            circumference: 180, // 180-degree chart
            rotation: 270, // rotate to start at the top
            responsive: true,
            maintainAspectRatio: false,
          },
        });
      };
      // End Profit vs Loss

      // Now Status
      const renderNowStatus = (data) => {
        const {
          Equity,
          Balance,
          Margin,
          FreeMargin,
          FreeMarginDrawdown,
          MarginLevel,
          Profit,
          StartBalanceDrawdown,
          MinBalanceEquity,
          MaxBalanceEquity,
        } = data;

        const stats = [
          {
            icon: "dollar-sign",
            color: "text-blue-500",
            label: "Balance",
            value: `$${Balance.toFixed(2)}`,
          },
          {
            icon: "trending-up",
            color: "text-green-500",
            label: "Equity",
            value: `$${Equity.toFixed(2)}`,
          },
          {
            icon: "arrow-up-circle",
            color: "text-purple-500",
            label: "Free Margin",
            value: `$${FreeMargin.toFixed(2)}`,
          },
          {
            icon: "arrow-down-circle",
            color: "text-red-500",
            label: "Free Margin Drawdown",
            value: `${FreeMarginDrawdown.toFixed(2)}%`,
          },
          {
            icon: "percent",
            color: "text-yellow-500",
            label: "Margin Level",
            value: `${MarginLevel.toFixed(2)}%`,
          },
          {
            icon: "activity",
            color: "text-indigo-500",
            label: "Profit",
            value: `$${Profit.toFixed(2)}`,
          },
          {
            icon: "bar-chart-2",
            color: "text-pink-500",
            label: "Start Balance Drawdown",
            value: `$${StartBalanceDrawdown.toFixed(2)}`,
          },
          {
            icon: "dollar-sign",
            color: "text-cyan-500",
            label: "Margin",
            value: `$${Margin.toFixed(2)}`,
          },
        ];

        // Line chart for balance range
        const lineChartData = {
          labels: ["Min", "Current", "Max"],
          datasets: [
            {
              label: "Value",
              data: [MinBalanceEquity, Balance, MaxBalanceEquity],
              borderColor: "#ec4899",
              borderWidth: 1,
              fill: false,
            },
          ],
        };

        new Chart($("#balanceRangeChart"), {
          type: "line",
          data: lineChartData,
          options: {
            responsive: true,
            plugins: {
              legend: { display: false },
            },
            scales: {
              x: {
                grid: {
                  display: true,
                  color: "#d1d5db",
                },
              },
              y: {
                grid: {
                  display: true,
                  color: "#d1d5db",
                },
                ticks: {
                  count: 5,
                },
              },
            },
          },
        });

        // Area chart for account overview
        const areaChartData = {
          labels: ["Balance", "Equity", "Free Margin", "Margin"],
          datasets: [
            {
              label: "Value",
              data: [Balance, Equity, FreeMargin, Margin],
              borderColor: "#3b82f6",
              backgroundColor: "#3b82f685",
              fill: true,
            },
          ],
        };

        new Chart($("#accountOverviewChart"), {
          type: "line",
          data: areaChartData,
          options: {
            responsive: true,
            plugins: {
              legend: { display: false },
            },
            scales: {
              x: {
                grid: {
                  display: true,
                  color: "#d1d5db",
                },
              },
              y: {
                grid: {
                  display: true,
                  color: "#d1d5db",
                },
                ticks: {
                  count: 5,
                },
              },
            },
          },
        });

        stats.forEach((stat) => {
          $("#statsContainer").append(`
                  <div class="flex items-center space-x-2">
                    <div>
                      <p class="text-sm text-muted-foreground flex items-center gap-2">
                        <i data-lucide=${stat.icon} class="w-3.5 h-3.5 ${stat.color}"></i>
                        <span class="truncate max-w-[120px]">${stat.label}</span>
                      </p>
                      <p class="text-lg font-semibold">${stat.value}</p>
                    </div>
                  </div>
                `);
        });

        lucide.createIcons();
      };
      // End Now Status

      // Positions Table
      const renderPositionsOrdersTable = (Positions, Orders) => {
        const formattedDate = (dateString) => {
          const date = new Date(dateString);
          const year = date.getFullYear();
          const month = String(date.getMonth() + 1).padStart(2, "0");
          const day = String(date.getDate()).padStart(2, "0");
          const hours = String(date.getHours()).padStart(2, "0");
          const minutes = String(date.getMinutes()).padStart(2, "0");
          const seconds = String(date.getSeconds()).padStart(2, "0");
          const milliseconds = String(date.getMilliseconds()).padStart(3, "0");

          return `${month}/${day}/${year}, ${hours}:${minutes}:${seconds}.${milliseconds}`;
        };

        function calculateTotal(data, key) {
          return data.reduce((total, item) => total + (item[key] || 0), 0);
        }

        const totalRow = (name, data) => {
          const totalNowPrice = calculateTotal(data, "NowPrice");
          const totalSwap = calculateTotal(data, "Swap");
          const totalProfit = calculateTotal(data, "Profit");
          const totalReason = calculateTotal(data, "Reason");

          const profitClass =
            totalProfit > 0 ? "text-green-500" : "text-rose-500";
          const profitIcon = totalProfit > 0 ? "trending-up" : "trending-down";

          return `
              <tr class="bg-gray-100 text-black text-sm">
                <td class="px-6 py-4 rounded-es-xl">${name}</td>
                <td colspan="7"></td>
                <td class="px-6 py-4">$${totalNowPrice.toFixed(2)}</td>
                <td class="px-6 py-4">${totalSwap.toFixed(2)}</td>
                <td class="px-6 py-4 flex items-center gap-1 ${profitClass}">
                  ${totalProfit.toFixed(2)}
                  <i data-lucide="${profitIcon}" class="w-3.5 h-3.5"></i>
                </td>
                <td class="px-6 py-4 rounded-ee-xl">${totalReason.toFixed(
                  2
                )}</td>
              </tr>
            `;
        };

        const $tableBody = $("#positions-orders-table-body");
        $tableBody.empty();

        if (Positions.length && Orders.length) {
          $tableBody.append(`
            <tr>
              <td colspan="12" class="text-center py-4">No data available</td>
            </tr>
          `);
        } else {
          Positions?.forEach((position) => {
            const formattedOpenTime = formattedDate(position.OpenTime);
            const profitClass =
              position.Profit > 0 ? "text-green-500" : "text-rose-500";
            const profitIcon =
              position.Profit > 0 ? "trending-up" : "trending-down";

            const row = `
              <tr class="odd:bg-white even:bg-gray-50 border-b last:border-none">
                <td class="px-6 py-4">${position.Ticket}</td>
                <td class="px-6 py-4">${position.Symbol}</td>
                <td class="px-6 py-4">${formattedOpenTime}</td>
                <td class="px-6 py-4">${position.TypeString}</td>
                <td class="px-6 py-4">${position.Volume}</td>
                <td class="px-6 py-4">${position.OpenPrice.toFixed(2)}</td>
                <td class="px-6 py-4">${position.StopLoss}</td>
                <td class="px-6 py-4">${position.TakeProfit}</td>
                <td class="px-6 py-4">$${position.NowPrice}</td>
                <td class="px-6 py-4">${position.Swap}</td>
                <td class="px-6 py-4 flex items-center gap-1 ${profitClass}">
                  ${position.Profit}
                  <i data-lucide="${profitIcon}" class="w-3.5 h-3.5"></i>
                </td>
                <td class="px-6 py-4">${position.Reason}</td>
              </tr>
            `;

            $tableBody.append(row);
          });

          if (Positions.length) {
            const totalPositionsRow = totalRow("Positions", Positions);
            $tableBody.append(totalPositionsRow);
          }

          Orders?.forEach((order) => {
            const formattedOpenTime = formattedDate(order.OpenTime);
            const profitClass =
              order.Profit > 0 ? "text-green-500" : "text-rose-500";
            const profitIcon =
              order.Profit > 0 ? "trending-up" : "trending-down";

            const row = `
              <tr class="odd:bg-white even:bg-gray-50 border-b last:border-none">
                <td class="px-6 py-4">${order.Ticket}</td>
                <td class="px-6 py-4">${order.Symbol}</td>
                <td class="px-6 py-4">${formattedOpenTime}</td>
                <td class="px-6 py-4">${order.TypeString}</td>
                <td class="px-6 py-4">${order.Volume}</td>
                <td class="px-6 py-4">${order.OpenPrice}</td>
                <td class="px-6 py-4">${order.StopLoss}</td>
                <td class="px-6 py-4">${order.TakeProfit}</td>
                <td class="px-6 py-4">$${order.NowPrice}</td>
                <td class="px-6 py-4">${order.Swap}</td>
                <td class="px-6 py-4 flex items-center gap-1 ${profitClass}">
                  ${order.Profit}
                  <i data-lucide="${profitIcon}" class="w-3.5 h-3.5"></i>
                </td>
                <td class="px-6 py-4">${order.Reason}</td>
              </tr>
            `;

            $tableBody.append(row);
          });

          if (Orders.length) {
            const totalOrdersRow = totalRow("Orders", Orders);
            $tableBody.append(totalOrdersRow);
          }
        }
        lucide.createIcons();
      };
      // End Positions Table

      // Chart Drawdown
      function renderChartDrawdown(data) {
        const labels = data.map((item) =>
          new Date(item.Time).toLocaleDateString("en-US", {
            month: "short",
            day: "numeric",
          })
        );

        const datasets = [
          {
            label: "Balance",
            data: data.map((item) => item.Balance),
            borderColor: "#eab308",
          },
          {
            label: "Min Equity",
            data: data.map((item) => item.MinEquity),
            borderColor: "#ec4899",
          },
          {
            label: "Max Equity",
            data: data.map((item) => item.MaxEquity),
            borderColor: "#3b82f6",
          },
          {
            label: "Start Balance",
            data: data.map((item) => item.StartBalance),
            borderColor: "#22c55e",
          },
          {
            label: "EOD Balance",
            data: data.map((item) => item.EODBalance),
            borderColor: "#a855f7",
          },
          {
            label: "MAT Balance",
            data: data.map((item) => item.MATBalance),
            borderColor: "#14b8a6",
          },
          {
            label: "MD Balance",
            data: data.map((item) => item.MDBalance),
            borderColor: "#f97316",
          },
        ];

        const ctx = document.getElementById("chart-drawdown").getContext("2d");
        new Chart(ctx, {
          type: "line",
          data: {
            labels,
            datasets: datasets.map((dataset) => ({
              ...dataset,
              tension: 0.1, // Smooth line curve
              borderWidth: 2,
              pointRadius: 0,
            })),
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: true }, // Show the legend for labels
            },
            scales: {
              x: {
                type: "category",
                grid: {
                  display: false,
                },
                ticks: { maxTicksLimit: 20 },
              },
              y: {
                beginAtZero: false,
                grid: {
                  color: "#e5e5e5",
                  drawBorder: false,
                },
                ticks: {
                  count: 10,
                  callback: function (value) {
                    return `${value.toFixed(2)}`;
                  },
                },
              },
            },
          },
        });
      }
      // End Chart Drawdown

      // History Positions Table
      const renderHistoryPositionsTable = (data) => {
        const newDataformatted = data.map((item) => {
          const {
            Ticket,
            Symbol,
            OpenTime,
            Type,
            Volume,
            OpenPrice,
            ClosePrice,
            CloseTime,
            PositionDuration,
            Commission,
            Swap,
            Profit,
            Reason,
          } = item;

          return [
            Ticket,
            Symbol,
            OpenTime,
            Type,
            Volume,
            OpenPrice,
            ClosePrice,
            CloseTime,
            PositionDuration,
            Commission,
            Swap,
            Profit,
            Reason,
          ];
        });

        console.log(newDataformatted);

        $("#history-positions-table").DataTable({
          data: newDataformatted,
          paging: true,
          searching: true,
          ordering: true,
          info: true,
          pageLength: 10,
        });
      };
      // End History Positions Table

      $(document).ready(async function () {
        // Tab switching logic
        const MainTabElements = [
          {
            id: "analyze",
            triggerEl: $("#analyze-tab"),
            targetEl: $("#analyze"),
          },
          {
            id: "history",
            triggerEl: $("#history-tab"),
            targetEl: $("#history"),
          },
        ];

        const MainTabOptions = {
          defaultTabId: "analyze",
          activeClasses:
            "text-blue-600 hover:text-blue-600 rounded-lg bg-white border-none shadow",
          inactiveClasses: "text-gray-500 hover:text-gray-600",
          onShow: () => {
            console.log("tab is shown");
          },
        };

        function showTab(tabId) {
          MainTabElements.forEach((tab) => {
            if (tab.id === tabId) {
              tab.triggerEl
                .addClass(MainTabOptions.activeClasses)
                .removeClass(MainTabOptions.inactiveClasses);
              tab.targetEl.removeClass("hidden");
              MainTabOptions.onShow();
            } else {
              tab.triggerEl
                .removeClass(MainTabOptions.activeClasses)
                .addClass(MainTabOptions.inactiveClasses);
              tab.targetEl.addClass("hidden");
            }
          });
        }

        showTab(MainTabOptions.defaultTabId);

        $(".main-tab-button").on("click", function () {
          const tabId = $(this).attr("id").split("-")[0];
          showTab(tabId);
        });
        // End Tabs Switching

        // Fetching Analyze Data
        const login = 799945;

        $("#analyze-loading").removeClass("hidden");
        $("#analyze-error").addClass("hidden");
        $("#analyze").addClass("hidden");

        fetchAnalyzeData(login)
          .then((res) => res.json())
          .then((data) => {
            $("#analyze-loading").addClass("hidden");
            $("#analyze").removeClass("hidden");

            const {
              Summary,
              PropAnalyze,
              NowStatus,
              HistoryBalance,
              HistoryGrowth,
              CountTrade,
              Positions,
              Orders,
            } = data;

            const { LimitVolume, ...res } = PropAnalyze;
            const newPropAnalyze = {
              ...res,
              RelativeDrawdown: NowStatus.RelativeDrawdown,
            };

            // Display Summary
            renderSumStats(Summary);
            renderSumChart(Summary);
            // End Display Summary

            // Display Prop Analyze
            renderPropAnalyze(newPropAnalyze);
            // End Display Prop Analyze

            // Display History Charts
            renderHistoryCharts(HistoryBalance, HistoryGrowth);
            // End Display History Charts

            // Display Trading Methods
            renderTradingMethods(CountTrade);
            renderTradimgMethodsChart(CountTrade);
            // End Display Trading Methods

            // Display Now Status
            renderNowStatus(NowStatus);
            // End Display Now Status

            // Display Profit vs Loss
            renderProfitVsLoss(CountTrade);
            renderProfitVsLossChart(CountTrade);
            // End Display Profit vs Loss

            // Display Positions & Orders Table
            renderPositionsOrdersTable(Positions, Orders);
            // End Display Positions & Orders Table
          })
          .catch((error) => {
            $("#analyze").addClass("hidden");
            $("#analyze-loading").addClass("hidden");
            $("#analyze-error").removeClass("hidden");
            $("#analyze-error-message").text(error.message);
          });
        // End Fetching Analyze Data

        // Fetching Drawdown Data
        $("#max-drawdown-loading").removeClass("hidden");
        $("#chart-drawdown-loading").removeClass("hidden");
        $("#max-drawdown-content").addClass("hidden");
        $("#analyze-error").addClass("hidden");

        fetchDrawdownData(login)
          .then((res) => res.json())
          .then((data) => {
            $("#max-drawdown-loading").addClass("hidden");
            $("#chart-drawdown-loading").addClass("hidden");
            $("#max-drawdown-content").removeClass("hidden");

            const {
              MaxAllTimeBalanceDrawdown,
              MaxAllTimeBalanceDrawdownTime,
              MaxDayBalanceDrawdown,
              MaxDayBalanceDrawdownTime,
              MaxEODBalanceDrawdown,
              MaxEODBalanceDrawdownTime,
              MaxFloatingDrawdown,
              MaxFloatingDrawdownTime,
              MaxStartBalanceDrawdown,
              MaxStartBalanceDrawdownTime,
              ChartDrawdown,
              ShowChartDrawdown,
            } = data;

            // Display Max Drawdown
            renderMaxDrawdown({
              ...ShowChartDrawdown,
              MaxAllTimeBalanceDrawdown,
              MaxAllTimeBalanceDrawdownTime,
              MaxDayBalanceDrawdown,
              MaxDayBalanceDrawdownTime,
              MaxEODBalanceDrawdown,
              MaxEODBalanceDrawdownTime,
              MaxFloatingDrawdown,
              MaxFloatingDrawdownTime,
              MaxStartBalanceDrawdown,
              MaxStartBalanceDrawdownTime,
            });
            // End Display Max Drawdown

            // Display Chart Drawdown
            renderChartDrawdown(ChartDrawdown);
            // End Display Chart Drawdown
          })
          .catch((error) => {
            $("#analyze").addClass("hidden");
            $("#analyze-error").removeClass("hidden");
            $("#analyze-error-message").text(error.message);
          });
        // End Fetching Drawdown Data

        // Fetching History Positions
        $("#history-positions-content").addClass("hidden");
        $("#history-positions-loading").removeClass("hidden");
        fetchHistoryPositionsData(login)
          .then((res) => res.json())
          .then((data) => {
            $("#history-positions-loading").addClass("hidden");
            $("#history-positions-content").removeClass("hidden");

            renderHistoryPositionsTable(data);
          })
          .catch((error) => {
            $("#history-positions-content").addClass("hidden");
            $("#analyze-error").removeClass("hidden");
            $("#analyze-error-message").text(error.message);
          });
        // End Fetching History Positions
      });
    </script>
  </body>
</html>
